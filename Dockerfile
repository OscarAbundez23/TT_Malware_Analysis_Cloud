ARG image=ubuntu:20.04

FROM ${image} as source-internet
FROM source-internet as builder

RUN apt-get update --quiet

RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    file \
    binutils \
    libimage-exiftool-perl
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    build-essential \
    git \ 
    wget 
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \    
    curl nano \
    swig \
    flex \
    bison
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    g++ \
    make \
    bsdmainutils \
    ssdeep
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    yara
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    make
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    pkg-config \
    valgrind 
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y \ 
    p7zip-full \
    upx-ucl \
    foremost
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y \ 
    elfutils\
    htop \
    cmake
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    gcc-multilib \
    g++-multilib \
    libc6-dbg
RUN DEBIAN_FRONTEND=noninteractive  apt-get install -y \
    scalpel \
    unzip \
    tree \
    zip
RUN DEBIAN_FRONTEND=noninteractive apt-get install -y \
    libsqlite3-dev \
    zlib1g-dev \
    libncurses5-dev \
    libgdbm-dev \
    libbz2-dev \
    libssl-dev \
    libdb-dev tk-dev

RUN apt-get install -y openjdk-17-jdk-headless

RUN wget https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_11.0.1_build/ghidra_11.0.1_PUBLIC_20240130.zip

RUN apt install -y python3-pip

#RUN apt-get install -y python3.11-venv

RUN apt install -y python3-virtualenv python3-venv

RUN wget https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz

RUN tar xzf Python-2.7.18.tgz

RUN cd Python-2.7.18

RUN ./Python-2.7.18/configure --prefix=/usr --enable-shared

RUN make

RUN make install

RUN python -m ensurepip --upgrade

WORKDIR /home

RUN python3 -m venv .env

RUN git clone https://github.com/radareorg/radare2
RUN radare2/sys/install.sh

RUN r2pm -U
RUN r2pm -ci esilsolve
#RUN r2pm -i r2dec
RUN r2pm -ci r2ghidra
RUN r2pm -ci r2ghidra-sleigh

RUN mkdir /home/ubuntu

COPY ./script_venv.sh /home

RUN chmod +x /home/script_venv.sh
RUN /home/script_venv.sh

COPY ./main.py /home/ubuntu
COPY ./ghidra_handler_module.py /home/ubuntu
