az group create --name myResourceGroup --location eastus
az acr create --resource-group myResourceGroup --name <acrName> --sku Basic

#Inició de sesión en el registro de contenedor
#Debe iniciar sesión en la instancia ACR antes de insertar imágenes en ella
#Use el comando az acr login para completar la operación

az acr login --name <acrName>


#Para insertar una imagen de contenedor en un registro privado como Azure Container Registry, 
#primero debe etiquetar la imagen con el nombre completo del servidor de inicio de sesión del registro.

#En primer lugar, obtenga el nombre del servidor de inicio de sesión completo de la instancia de Azure Container Registry. 

az acr show --name <acrName> --query loginServer --output table

#Output ejemplo
#Result
#------------------------
#mycontainerregistry082.azurecr.io

#Etiquetar imagen del registro del contenedor
docker tag aci-tutorial-app <acrLoginServer>/aci-tutorial-app:v1

#Inserción de imágenes en ACR
docker push <acrLoginServer>/aci-tutorial-app:v1

#Listar imágenes en ACR
#Para comprobar que la imagen que acaba de insertar está efectivamente en el registro
#de contenedor de Azure, enumere las imágenes del registro con el comando az acr repository list. 

#Obtención de las credenciales del registro
#Al implementar una imagen que se hospeda en una instancia privada de ACR
#debe proporcionarse las credenciales de acceso al registro


az acr show --name oscarabundez --query loginServer

#Implementación de un contenedor
#Utilice az container create para implementar el contenedor
#Reemplace <acrLoginServer> por el valor obtenido con el comando anterior.
#Reemplace <service-principal-ID> y <service-principal-password> por el
#identificador de la entidad de servicio y la contraseña que creó para acceder
#registro. Reemplace <aciDnsLabel> por el nombre de DNS que desee.
az container create --resource-group myResourceGroup --name aci-tutorial-app --image <acrLoginServer>/aci-tutorial-app:v1 --cpu 1 --memory 1 --registry-login-server <acrLoginServer> --registry-username <service-principal-ID> --registry-password <service-principal-password> --ip-address Public --dns-name-label <aciDnsLabel> --ports 80

#Comprobación del progreso de la implementación
az container show --resource-group myResourceGroup --name aci-tutorial-app --query instanceView.state
#Repita el comando az container show hasta que el estado cambie de 
#Pendiente a En ejecución, lo que debe tardar menos de un minuto. 
#Cuando el contenedor esté en En ejecución, continúe con el paso siguiente.

#Visualización de los registros de contenedor y aplicación
#Utilice el siguiente comando para mostrar el nombre de dominio completo (FQDN) del contenedor
az container show --resource-group myResourceGroup --name aci-tutorial-app --query ipAddress.fqdn

#Ejemplo
#"aci-demo.eastus.azurecontainer.io"

#También puede ver la salida de registro del contenedor:
az container logs --resource-group myResourceGroup --name aci-tutorial-app

#listening on port 80
#::ffff:10.240.0.4 - - [21/Jul/2017:06:00:02 +0000] "GET / HTTP/1.1" 200 1663 "-" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36"
#::ffff:10.240.0.4 - - [21/Jul/2017:06:00:02 +0000] "GET /favicon.ico HTTP/1.1" 404 150 "http://aci-demo.eastus.azurecontainer.io/" "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.3071.115 Safari/537.36"

#Limpieza de recursos
az group delete --name myResourceGroup
